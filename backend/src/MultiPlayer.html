<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tic Tac Toe Multiplayer</title>
</head>
<style>
    body {
        font-family: sans-serif;
        text-align: center;
        background: #121212;
        color: white;
    }

    .board {
        display: grid;
        grid-template-columns: repeat(3, 100px);
        gap: 0px;
        justify-content: center;
        margin-top: 20px;
    }

    @keyframes _fadeIn  {
        0% {
            opacity: 0%;
        }
        100% {
            opacity: 100%;
        }
    }

    @keyframes _float_in {
        0% {
            transform: translateY(-100%);
            opacity: 0%;
        }
        100% {
            transform: translateY(0);
            opacity: 100%;
        }
    }


    .cell {
        width: 100px;
        height: 100px;
        font-size: 2em;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }

</style>
<body>
<h1>Tic Tac Toe</h1>

<div id="room">
    <input id="roomId" placeholder="Enter room ID" />
    <button id="joinBtn">Join Room</button>
</div>

<div id="game" style="display:none;">
    <p id="status"></p>
   <div id="BoardBox">
       <div id="board" class="board"></div>
   </div>
</div>

<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<script>
    const socket = io();
    const joinBtn = document.getElementById("joinBtn");
    const roomInput = document.getElementById("roomId");
    const gameDiv = document.getElementById("game");
    const boardDiv = document.getElementById("board");
    const statusP = document.getElementById("status");

    let roomId = null;
    let board = Array(9).fill(null);
    let bg = Math.random() * 360;

    document.body.style.background = `hsl(${bg}, 70%, 20%)`;

    joinBtn.onclick = () => {
        roomId = roomInput.value.trim();
        if (roomId) socket.emit("joinRoom", roomId);
    };

    socket.on("joined", () => {
        document.getElementById("room").style.display = "none";
        gameDiv.style.display = "block";
    });

    socket.on("playerCount", (count) => {
        statusP.textContent = count < 2 ? "Waiting for opponent..." : "Game started!";
    });

    socket.on("startGame", ({ turn }) => {
        statusP.textContent = `${turn}'s turn`;
        renderBoard();
    });

    socket.on("updateBoard", (newBoard) => {
        board = newBoard;
        renderBoard();
    });

    socket.on("nextTurn", (turn) => {
        statusP.textContent = `${turn}'s turn`;
    });

    socket.on("gameOver", ({ winner }) => {
        setTimeout(() => {
            alert(`${winner} wins!`);
            board = Array(9).fill(null);
            renderBoard();
            statusP.textContent = "Game restarted! X's turn";
        }, 2000)
    });

    function renderBoard() {
        boardDiv.innerHTML = "";
        board.forEach((cell, i) => {
            const div = document.createElement("div");
            div.className = "cell";
            div.textContent = cell || "";
            div.onclick = () => {
                socket.emit("move", { roomId, index: i });
            };

            if (i == 0) {
                div.style.borderRadius = "20% 0 0";
            } else if (i == 2) {
                div.style.borderRadius = "0 20% 0 0";
            } else if (i == 6) {
                div.style.borderRadius = "0 0 0 20%";
            } else if (i == 8) {
                div.style.borderRadius = "0 0 20% 0";
            }

            div.style.background = `hsl(${bg}, 100%, 50%)`;
            div.style.border = `2px solid hsl(${bg}, 100%, 30%)`;
            div.textContent = cell || "";
            boardDiv.appendChild(div);
        });
    }

</script>
</body>
</html>
